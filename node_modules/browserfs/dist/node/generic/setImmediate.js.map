{"version":3,"file":"setImmediate.js","sourceRoot":"","sources":["../../../src/generic/setImmediate.ts"],"names":[],"mappings":";AAAA,yCAAoC;AAEpC;;GAEG;AACH,IAAI,eAAsC,CAAC;AAC3C,EAAE,CAAC,CAAC,OAAM,CAAC,YAAY,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC;IACzC,eAAe,GAAG,YAAY,CAAC;AACjC,CAAC;AAAC,IAAI,CAAC,CAAC;IACN,IAAM,QAAM,GAAG,mBAAM,CAAC;IACtB,IAAM,UAAQ,GAAmB,EAAE,CAAC;IACpC,IAAM,aAAW,GAAG,sBAAsB,CAAC;IAC3C,IAAM,iBAAiB,GAAG;QACxB,EAAE,CAAC,CAAC,OAAO,QAAM,CAAC,aAAa,KAAK,WAAW,IAAI,CAAC,QAAM,CAAC,WAAW,CAAC,CAAC,CAAC;YACvE,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QACD,IAAI,kBAAkB,GAAG,IAAI,CAAC;QAC9B,IAAM,YAAY,GAAG,QAAM,CAAC,SAAS,CAAC;QACtC,QAAM,CAAC,SAAS,GAAG;YACjB,kBAAkB,GAAG,KAAK,CAAC;QAC7B,CAAC,CAAC;QACF,QAAM,CAAC,WAAW,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;QAC5B,QAAM,CAAC,SAAS,GAAG,YAAY,CAAC;QAChC,MAAM,CAAC,kBAAkB,CAAC;IAC5B,CAAC,CAAC;IACF,EAAE,CAAC,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;QACxB,eAAe,GAAG,UAAS,EAAc;YACvC,UAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAClB,QAAM,CAAC,WAAW,CAAC,aAAW,EAAE,GAAG,CAAC,CAAC;QACvC,CAAC,CAAC;QACF,IAAM,aAAa,GAAG,UAAS,KAAmB;YAChD,EAAE,CAAC,CAAC,KAAK,CAAC,MAAM,KAAK,IAAI,IAAI,KAAK,CAAC,IAAI,KAAK,aAAW,CAAC,CAAC,CAAC;gBACxD,EAAE,CAAC,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;oBAC1B,KAAK,CAAC,eAAe,EAAE,CAAC;gBAC1B,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACN,KAAK,CAAC,YAAY,GAAG,IAAI,CAAC;gBAC5B,CAAC;gBACD,EAAE,CAAC,CAAC,UAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;oBACxB,IAAM,EAAE,GAAG,UAAQ,CAAC,KAAK,EAAG,CAAC;oBAC7B,MAAM,CAAC,EAAE,EAAE,CAAC;gBACd,CAAC;YACH,CAAC;QACH,CAAC,CAAC;QACF,EAAE,CAAC,CAAC,QAAM,CAAC,gBAAgB,CAAC,CAAC,CAAC;YAC5B,QAAM,CAAC,gBAAgB,CAAC,SAAS,EAAE,aAAa,EAAE,IAAI,CAAC,CAAC;QAC1D,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,QAAM,CAAC,WAAW,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;QACjD,CAAC;IACH,CAAC;IAAC,IAAI,CAAC,EAAE,CAAC,CAAC,QAAM,CAAC,cAAc,CAAC,CAAC,CAAC;QACjC,2BAA2B;QAC3B,IAAM,SAAO,GAAG,IAAI,QAAM,CAAC,cAAc,EAAE,CAAC;QAC5C,SAAO,CAAC,KAAK,CAAC,SAAS,GAAG,UAAC,KAAU;YACnC,EAAE,CAAC,CAAC,UAAQ,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;gBACxB,MAAM,CAAC,UAAQ,CAAC,KAAK,EAAG,EAAE,CAAC;YAC7B,CAAC;QACH,CAAC,CAAC;QACF,eAAe,GAAG,UAAC,EAAc;YAC/B,UAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAClB,SAAO,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;QAChC,CAAC,CAAC;IACJ,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,eAAe,GAAG,UAAS,EAAc;YACvC,MAAM,CAAC,UAAU,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;QAC3B,CAAC,CAAC;IACJ,CAAC;AACH,CAAC;AAED,qBAAe,eAAe,CAAC","sourcesContent":["import global from '../core/global';\n\n/**\n * @hidden\n */\nlet bfsSetImmediate: (cb: Function) => any;\nif (typeof(setImmediate) !== \"undefined\") {\n  bfsSetImmediate = setImmediate;\n} else {\n  const gScope = global;\n  const timeouts: (() => void)[] = [];\n  const messageName = \"zero-timeout-message\";\n  const canUsePostMessage = function() {\n    if (typeof gScope.importScripts !== 'undefined' || !gScope.postMessage) {\n      return false;\n    }\n    let postMessageIsAsync = true;\n    const oldOnMessage = gScope.onmessage;\n    gScope.onmessage = function() {\n      postMessageIsAsync = false;\n    };\n    gScope.postMessage('', '*');\n    gScope.onmessage = oldOnMessage;\n    return postMessageIsAsync;\n  };\n  if (canUsePostMessage()) {\n    bfsSetImmediate = function(fn: () => void) {\n      timeouts.push(fn);\n      gScope.postMessage(messageName, \"*\");\n    };\n    const handleMessage = function(event: MessageEvent) {\n      if (event.source === self && event.data === messageName) {\n        if (event.stopPropagation) {\n          event.stopPropagation();\n        } else {\n          event.cancelBubble = true;\n        }\n        if (timeouts.length > 0) {\n          const fn = timeouts.shift()!;\n          return fn();\n        }\n      }\n    };\n    if (gScope.addEventListener) {\n      gScope.addEventListener('message', handleMessage, true);\n    } else {\n      gScope.attachEvent('onmessage', handleMessage);\n    }\n  } else if (gScope.MessageChannel) {\n    // WebWorker MessageChannel\n    const channel = new gScope.MessageChannel();\n    channel.port1.onmessage = (event: any) => {\n      if (timeouts.length > 0) {\n        return timeouts.shift()!();\n      }\n    };\n    bfsSetImmediate = (fn: () => void) => {\n      timeouts.push(fn);\n      channel.port2.postMessage('');\n    };\n  } else {\n    bfsSetImmediate = function(fn: () => void) {\n      return setTimeout(fn, 0);\n    };\n  }\n}\n\nexport default bfsSetImmediate;\n"]}