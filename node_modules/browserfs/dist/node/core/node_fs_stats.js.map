{"version":3,"file":"node_fs_stats.js","sourceRoot":"","sources":["../../../src/core/node_fs_stats.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from 'fs';\n\n/**\n * Indicates the type of the given file. Applied to 'mode'.\n */\nexport enum FileType {\n  FILE = 0x8000,\n  DIRECTORY = 0x4000,\n  SYMLINK = 0xA000\n}\n\n/**\n * Emulation of Node's `fs.Stats` object.\n *\n * Attribute descriptions are from `man 2 stat'\n * @see http://nodejs.org/api/fs.html#fs_class_fs_stats\n * @see http://man7.org/linux/man-pages/man2/stat.2.html\n */\nexport default class Stats implements fs.Stats {\n  public static fromBuffer(buffer: Buffer): Stats {\n    const size = buffer.readUInt32LE(0),\n      mode = buffer.readUInt32LE(4),\n      atime = buffer.readDoubleLE(8),\n      mtime = buffer.readDoubleLE(16),\n      ctime = buffer.readDoubleLE(24);\n\n    return new Stats(mode & 0xF000, size, mode & 0xFFF, new Date(atime), new Date(mtime), new Date(ctime));\n  }\n\n  public blocks: number;\n  public mode: number;\n  /**\n   * UNSUPPORTED ATTRIBUTES\n   * I assume no one is going to need these details, although we could fake\n   * appropriate values if need be.\n   */\n  // ID of device containing file\n  public dev: number = 0;\n  // inode number\n  public ino: number = 0;\n  // device ID (if special file)\n  public rdev: number = 0;\n  // number of hard links\n  public nlink: number = 1;\n  // blocksize for file system I/O\n  public blksize: number = 4096;\n  // @todo Maybe support these? atm, it's a one-user filesystem.\n  // user ID of owner\n  public uid: number = 0;\n  // group ID of owner\n  public gid: number = 0;\n  // time file was created (currently unsupported)\n  public birthtime: Date = new Date(0);\n  // XXX: Some file systems stash data on stats objects.\n  public fileData: Buffer | null= null;\n\n  /**\n   * Provides information about a particular entry in the file system.\n   * @param [Number] item_type type of the item (FILE, DIRECTORY, SYMLINK, or SOCKET)\n   * @param [Number] size Size of the item in bytes. For directories/symlinks,\n   *   this is normally the size of the struct that represents the item.\n   * @param [Number] mode Unix-style file mode (e.g. 0o644)\n   * @param [Date?] atime time of last access\n   * @param [Date?] mtime time of last modification\n   * @param [Date?] ctime time of creation\n   */\n  constructor(\n    itemType: FileType,\n    public size: number,\n    mode?: number,\n    public atime: Date = new Date(),\n    public mtime: Date = new Date(),\n    public ctime: Date = new Date()) {\n    if (!mode) {\n      switch (itemType) {\n        case FileType.FILE:\n          this.mode = 0x1a4;\n          break;\n        case FileType.DIRECTORY:\n        default:\n          this.mode = 0x1ff;\n      }\n    } else {\n      this.mode = mode;\n    }\n    // number of 512B blocks allocated\n    this.blocks = Math.ceil(size / 512);\n    // Check if mode also includes top-most bits, which indicate the file's\n    // type.\n    if (this.mode < 0x1000) {\n      this.mode |= itemType;\n    }\n  }\n\n  public toBuffer(): Buffer {\n    const buffer = Buffer.alloc(32);\n    buffer.writeUInt32LE(this.size, 0);\n    buffer.writeUInt32LE(this.mode, 4);\n    buffer.writeDoubleLE(this.atime.getTime(), 8);\n    buffer.writeDoubleLE(this.mtime.getTime(), 16);\n    buffer.writeDoubleLE(this.ctime.getTime(), 24);\n    return buffer;\n  }\n\n  /**\n   * **Nonstandard**: Clone the stats object.\n   * @return [BrowserFS.node.fs.Stats]\n   */\n  public clone(): Stats {\n    return new Stats(this.mode & 0xF000, this.size, this.mode & 0xFFF, this.atime, this.mtime, this.ctime);\n  }\n\n  /**\n   * @return [Boolean] True if this item is a file.\n   */\n  public isFile(): boolean {\n    return (this.mode & 0xF000) === FileType.FILE;\n  }\n\n  /**\n   * @return [Boolean] True if this item is a directory.\n   */\n  public isDirectory(): boolean {\n    return (this.mode & 0xF000) === FileType.DIRECTORY;\n  }\n\n  /**\n   * @return [Boolean] True if this item is a symbolic link (only valid through lstat)\n   */\n  public isSymbolicLink(): boolean {\n    return (this.mode & 0xF000) === FileType.SYMLINK;\n  }\n\n  /**\n   * Change the mode of the file. We use this helper function to prevent messing\n   * up the type of the file, which is encoded in mode.\n   */\n  public chmod(mode: number): void {\n    this.mode = (this.mode & 0xF000) | mode;\n  }\n\n  // We don't support the following types of files.\n\n  public isSocket(): boolean {\n    return false;\n  }\n\n  public isBlockDevice(): boolean {\n    return false;\n  }\n\n  public isCharacterDevice(): boolean {\n    return false;\n  }\n\n  public isFIFO(): boolean {\n    return false;\n  }\n}\n"]}